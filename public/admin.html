<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Posteingang</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <h1>Admin: Posteingang</h1>
    <p>Gib dein Admin-Token ein, um die letzten Nachrichten vom IMAP-Postfach abzurufen.</p>
    <label>
      Admin-Token
      <input id="token" type="password" />
    </label>
    <button id="load">Nachrichten laden</button>
    <div id="status"></div>
    <ul id="list"></ul>
  </main>

  <script>
    document.getElementById('load').addEventListener('click', async () => {
      const token = document.getElementById('token').value.trim();
      if (!token) { alert('Bitte Token eingeben'); return; }
      document.getElementById('status').textContent = 'Lade...';
      const res = await fetch('/messages', { headers: { 'x-admin-token': token }});
      const json = await res.json();
      if (!res.ok) {
        document.getElementById('status').textContent = 'Fehler: ' + (json.error || res.statusText);
        return;
      }
      document.getElementById('status').textContent = '';
      const ul = document.getElementById('list');
      ul.innerHTML = '';
      (json.messages || []).forEach(m => {
        const li = document.createElement('li');
        li.innerHTML = '<strong>' + (m.subject || '(kein Betreff)') + '</strong><br/>' +
                       '<em>Von: ' + (m.from || '') + ' â€” ' + (new Date(m.date)).toLocaleString() + '</em>';
        ul.appendChild(li);
      });
    });
  </script>
</body>
</html>
